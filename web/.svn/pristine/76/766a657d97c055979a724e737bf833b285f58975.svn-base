<?php
//====================================================
//		FileName: index.php
//		Summary:  程序入口文件
//====================================================
header("Content-type: text/html; charset=utf-8");
session_start();
error_reporting(0);

//配置数据库
$cfg["dbhost"]="localhost";     //数据库主机名
$cfg["dbuser"]="root";		    //数据库用户名
$cfg["dbpass"]="jdqmjsb3307"; 				//数据库密码
$cfg["dbname"]="esm";  			//数据库名称
$cfg["webname"]="山西冀东启明科技有限公司"; //系统名称

//打卡时间
$attendance_txt ="注:公司打卡时间 早晨8:00-9:00 中午11:00-13:00 下午18:00-24:00"; 


//引入类库及公共方法
@define("CORE",dirname(__FILE__)."/"); 	    //根目录    dirname(string path)返回路径中的目录部分
require_once("lib/mysql.class.php");        //数据类
require_once("lib/smarty.class.php");       //模版类
require_once('lib/json.class.php');		    //JSON类
require_once("lib/func.class.php");         //核心类
require_once("lib/rabc.class.php");         //查询类
require_once("lib/image.class.php");        //图片类


//操作值
$action=empty($_GET['action'])?'':trim($_GET['action']); 	 //get action值     判断action的get传值是否为空，如果为空则返回空，否则返回action的Get传值
$do=empty($_GET['do'])?'':trim($_GET['do']);			 	 //get do值
$id=empty($_GET['id'])?'':intval($_GET['id']);				 //get id值    intval()获取变量的整数值
$cuserid=empty($_GET['userid'])?'':intval($_GET['userid']);  //get userid值


//读取参数数组
$sql_tt="SELECT id,title,type FROM `rv_type`";
$db->query($sql_tt);//执行SQL语句
$type_cut=$db->fetchAll();//取出所有的记录（数组形式）
foreach ($type_cut as $key => $val) {//foreach遍历数组或对象
	$type_cut[$val[type]][$val[id]] = $val[title];
	unset($type_cut[$key]);//取消掉引用
}

 

//初始值参数数组
$areaid=$type_cut[areaid];				//区域参数
$typeid=$type_cut[typeid];				//类型参数
$productid=$type_cut[productid];		//维护参数
$doctid=$type_cut[doctid];				//文档参数



//读取用户数组
$sql_user="SELECT id,username FROM `rv_user`";
$db->query($sql_user);
$user_arr=$db->fetchAll();
foreach($user_arr as $key=>$val){
	$user_list[$user_arr[$key][id]]=$user_arr[$key][username];	 //用户数组
}

	//物品类别
	$sql="SELECT id,name FROM `rv_product`";
	$db->query($sql);
	$product_arr=$db->fetchAll();
	 // 格式化输出数据
	foreach($product_arr as $key=>$val){
		$product_list[$product_arr[$key][id]] = $product_arr[$key][name];	//物品名称数组		
	}
//查询
	$sql="SELECT id,name FROM `rv_room`";
	$db->query($sql);
	$room_arr=$db->fetchAll();
	 //格式化输出数据
	foreach($room_arr as $key=>$val){
		$room_list[$room_arr[$key][id]] = $room_arr[$key][name];	//仓库名称数组		
	}
	//查询
	$sql="SELECT id,name FROM `rv_supplier`";
	$db->query($sql);
	$supplier_arr=$db->fetchAll();
	 //格式化输出数据
	foreach($supplier_arr as $key=>$val){
		$supplier_list[$supplier_arr[$key][id]] = $supplier_arr[$key][name];	//供应商名称数组		
	}

	
	//出库管理 物品选择
	$sql="SELECT id,name FROM `rv_product`";
	$db->query($sql);
	$prod_arr=$db->fetchAll();
	 //格式化输出数据
	foreach($prod_arr as $key=>$val){
		$prod_list[$prod_arr[$key][id]] = $prod_arr[$key][name];	//物品类型数组		
	} 
	
	//出库管理 仓库选择
	$sql="SELECT id,name FROM `rv_room`";
	$db->query($sql);
	$room_arr=$db->fetchAll();
	 //格式化输出数据
	foreach($room_arr as $key=>$val){
		$room_list[$room_arr[$key][id]] = $room_arr[$key][name];	//物品类型数组		
	}

	//出库管理 选择公司
	$sql="SELECT id,name FROM `rv_supplier`";
	$db->query($sql);
	$chu_arr=$db->fetchAll();
	 //格式化输出数据
	foreach($chu_arr as $key=>$val){
		$chu_list[$chu_arr[$key][id]] = $chu_arr[$key][name];	//物品类型数组		
	} 

//执行页面
switch ($action){
	case "":
	  include('action/action.index.php');     //首页
	  break;
	case "info":
	  include('action/action.info.php');      //车辆
	  break;
	case "sell":
	  include('action/action.sell.php');      //维护
	  break;
	case "daily":
	  include('action/action.daily.php');     //日报
	  break;
	case "room":
	  include('action/action.room.php');      //仓库
	  break;
	case "sort":
	  include('action/action.sort.php');      //物品类别
	  break;
	case "product":
	  include('action/action.product.php');     //物品信息
	  break;
	case "supplier":
	  include('action/action.supplier.php');     //供货商管理
	  break;
	case "storage_ru":
	  include('action/action.storage_ru.php');     //入库信息
	  break;
	case "storage_chu":
	  include('action/action.storage_chu.php');     //出库信息
	  break;
	case "storage":
	  include('action/action.storage.php');     //库房信息
	  break;
	  
	case "photo":
	  include('action/action.photo.php');     //照片
	  break;
	case "tel":
	  include('action/action.tel.php');       //电话
	  break;
	case "doc":
	  include('action/action.doc.php');       //公告
	  break;
	case "track":
	  include('action/action.track.php');     //打卡
	  break;
	case "note":
	  include('action/action.note.php');      //反馈
	  break;
	case "report":
	  include('action/action.report.php');    //报表
	  break;
	case "config":
	  include('action/action.config.php');    //配置
	  break;
	case "role":
	  include('action/action.role.php');      //角色
	  break;
	case "user":
	  include('action/action.user.php');      //用户
	  break;
	case "data":
	  include('action/action.data.php');      //数据
	  break;
	case "mobile":
	  include('action/action.mobile.php');	  //手机
	  break;
	default:
	  echo "404!";
}

?>